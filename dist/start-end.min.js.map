{"version":3,"file":"start-end.min.js","sources":["../src/utils.js","../src/token-collection.js","../src/part.js","../src/comma-dsl.js"],"sourcesContent":["\r\nexport const createEmptyObject = Object.create.bind(null, null)\r\nexport const freeze = Object.freeze\r\nexport const isArray = Array.isArray\r\n\r\nexport function def (o, p, attributesOrFn) {\r\n  if (isFunction(attributesOrFn)) {\r\n    attributesOrFn = {\r\n      get: attributesOrFn\r\n    }\r\n  }\r\n  return Object.defineProperty(o, p, attributesOrFn)\r\n}\r\n\r\nexport function isFunction (o) {\r\n  return typeof o === 'function'\r\n}\r\n\r\nexport function bindArgs (fn, ...args) {\r\n  return fn.bind(null, ...args)\r\n}\r\n\r\nfunction uniqueObjectToString () {\r\n  return 'UniqueObject(' + this._desc + ')'\r\n}\r\n\r\nexport function createUniqueObject (desc) {\r\n  let obj = createEmptyObject()\r\n  obj._desc = desc\r\n  return freeze(def(obj, 'toString', uniqueObjectToString))\r\n}\r\n","import { createEmptyObject } from './utils'\r\n\r\nconst fetchTokenPlaceholder = '_fetchToken$$'\r\n\r\n/**\r\n * create a token collection\r\n * @example\r\n * const Collection = makeTokenCollection(['div', 'span'])\r\n * const tokens = new Collection()\r\n * tokens.div === 'div'\r\n *\r\n * @param {string[]} tags\r\n * @param {function} fetchTokenCallback\r\n * @returns mixed\r\n */\r\nexport function makeTokenCollection (tags, fetchTokenCallback = (collection, token) => token) {\r\n  const props = tags.reduce((props, token) => {\r\n    props[token] = {\r\n      get: function () {\r\n        return this[fetchTokenPlaceholder](this, token)\r\n      },\r\n      enumerable: true\r\n    }\r\n    return props\r\n  }, {})\r\n\r\n  props[fetchTokenPlaceholder] = {\r\n    value: fetchTokenCallback,\r\n    enumerable: false,\r\n    writable: true\r\n  }\r\n\r\n  const proto = createEmptyObject()\r\n  Object.defineProperties(proto, props)\r\n\r\n  function TokenCollection (cb = null) {\r\n    if (!(this instanceof TokenCollection)) {\r\n      throw new Error('Shouldn\\'t call TokenCollection constructor directly.')\r\n    }\r\n\r\n    if (typeof cb === 'function') {\r\n      this[fetchTokenPlaceholder] = cb\r\n    }\r\n  }\r\n\r\n  TokenCollection.prototype = proto\r\n  return TokenCollection\r\n}\r\n","export default class Part {\r\n  constructor (value = null, type = null) {\r\n    this.value = value\r\n    this.type = type\r\n  }\r\n}\r\n","import Part from './part'\r\nimport { bindArgs, isFunction, createUniqueObject } from './utils'\r\n\r\nconst attrTypePart = createUniqueObject('attr')\r\nconst contentTypePart = createUniqueObject('content')\r\n\r\nfunction pushStartTag ({ dsl }, tag) {\r\n  if (!dsl.startTagStack) {\r\n    dsl.startTagStack = []\r\n  }\r\n  /* hook */\r\n  if (isFunction(dsl['beforePushStartTag'])) {\r\n    const newTag = dsl.beforePushStartTag(dsl, tag)\r\n    tag = newTag || tag\r\n  }\r\n\r\n  dsl.startTagStack.push(tag)\r\n  return bindArgs(pushEndTag, { dsl }, tag)\r\n}\r\n\r\nfunction pushEndTag ({ dsl }, tag) {\r\n  if (!dsl.endTagStack) {\r\n    dsl.endTagStack = []\r\n  }\r\n  /* hook */\r\n  if (isFunction(dsl['beforePushEndTag'])) {\r\n    const newTag = dsl.beforePushEndTag(dsl, tag)\r\n    tag = newTag || tag\r\n  }\r\n\r\n  dsl.endTagStack.push(tag)\r\n  return dsl\r\n}\r\n\r\nfunction pushPart (dsl, type, data) {\r\n  let part\r\n  /* hook */\r\n  if (isFunction(dsl['beforePushPart'])) {\r\n    part = dsl.beforePushPart(dsl, type, data)\r\n  }\r\n  if (!part) {\r\n    part = new Part(data, type)\r\n  }\r\n  dsl.startTagStack.push(part)\r\n  return dsl\r\n}\r\n\r\nexport class CommaDsl {\r\n  constructor (TagCollection) {\r\n    this.startTagStack = []\r\n    this.endTagStack = []\r\n    this.TagCollection = TagCollection\r\n    this.startTokens = null\r\n    this.endTokens = null\r\n    this.contentPart = null\r\n    this.attrPart = null\r\n  }\r\n\r\n  get startTag () {\r\n    if (!this.startTokens) {\r\n      this.startTokens = new this.TagCollection(pushStartTag)\r\n      this.startTokens.dsl = this\r\n    }\r\n    return this.startTokens\r\n  }\r\n\r\n  get endTag () {\r\n    if (!this.endTokens) {\r\n      this.endTokens = new this.TagCollection(pushEndTag)\r\n      this.endTokens.dsl = this\r\n    }\r\n    return this.endTokens\r\n  }\r\n\r\n  get attr () {\r\n    if (!this.attrPart) {\r\n      this.attrPart = bindArgs(pushPart, this, attrTypePart)\r\n    }\r\n    return this.attrPart\r\n  }\r\n\r\n  get content () {\r\n    if (!this.contentPart) {\r\n      this.contentPart = bindArgs(pushPart, this, contentTypePart)\r\n    }\r\n    return this.contentPart\r\n  }\r\n\r\n  static isAttr (part) {\r\n    return part.type === attrTypePart\r\n  }\r\n\r\n  static isContent (part) {\r\n    return part.type === contentTypePart\r\n  }\r\n}\r\n"],"names":["createEmptyObject","Object","create","bind","freeze","isFunction","o","bindArgs","fn","args","uniqueObjectToString","this","_desc","createUniqueObject","desc","obj","p","attributesOrFn","get","defineProperty","def","fetchTokenPlaceholder","Part","value","type","attrTypePart","contentTypePart","pushStartTag","tag","dsl","startTagStack","beforePushStartTag","push","pushEndTag","endTagStack","beforePushEndTag","pushPart","data","part","beforePushPart","CommaDsl","TagCollection","startTokens","endTokens","contentPart","attrPart","isAttr","isContent","tags","fetchTokenCallback","collection","token","props","reduce","enumerable","writable","proto","TokenCollection","cb","Error","defineProperties","prototype"],"mappings":"qMACO,IAAMA,EAAoBC,OAAOC,OAAOC,KAAK,KAAM,MAC7CC,EAASH,OAAOG,OAYtB,SAASC,EAAYC,SACN,mBAANA,EAGT,SAASC,EAAUC,8BAAOC,mCAAAA,2BACxBD,EAAGL,WAAHK,GAAQ,aAASC,IAG1B,SAASC,UACA,gBAAkBC,KAAKC,MAAQ,IAGjC,SAASC,EAAoBC,OAC9BC,EAAMf,WACVe,EAAIH,MAAQE,EACLV,EAxBF,SAAcE,EAAGU,EAAGC,UACrBZ,EAAWY,KACbA,EAAiB,CACfC,IAAKD,IAGFhB,OAAOkB,eAAeb,EAAGU,EAAGC,GAkBrBG,CAAIL,EAAK,WAAYL,IC3BrC,IAAMW,EAAwB,0LCFTC,EACnB,SAAaC,EAAcC,YAAdD,IAAAA,EAAQ,eAAMC,IAAAA,EAAO,WAC3BD,MAAQA,OACRC,KAAOA,GCAVC,EAAeZ,EAAmB,QAClCa,EAAkBb,EAAmB,WAE3C,SAASc,IAAuBC,OAAPC,IAAAA,KAClBA,EAAIC,gBACPD,EAAIC,cAAgB,IAGlBzB,EAAWwB,EAAG,uBAEhBD,EADeC,EAAIE,mBAAmBF,EAAKD,IAC3BA,UAGlBC,EAAIC,cAAcE,KAAKJ,GAChBrB,EAAS0B,EAAY,CAAEJ,IAAAA,GAAOD,GAGvC,SAASK,IAAqBL,OAAPC,IAAAA,KAChBA,EAAIK,cACPL,EAAIK,YAAc,IAGhB7B,EAAWwB,EAAG,qBAEhBD,EADeC,EAAIM,iBAAiBN,EAAKD,IACzBA,UAGlBC,EAAIK,YAAYF,KAAKJ,GACdC,EAGT,SAASO,EAAUP,EAAKL,EAAMa,OACxBC,SAEAjC,EAAWwB,EAAG,kBAChBS,EAAOT,EAAIU,eAAeV,EAAKL,EAAMa,IAElCC,IACHA,EAAO,IAAIhB,EAAKe,EAAMb,IAExBK,EAAIC,cAAcE,KAAKM,GAChBT,MAGIW,EAAb,sBACeC,QACNX,cAAgB,QAChBI,YAAc,QACdO,cAAgBA,OAChBC,YAAc,UACdC,UAAY,UACZC,YAAc,UACdC,SAAW,cAiCXC,OAAP,SAAeR,UACNA,EAAKd,OAASC,KAGhBsB,UAAP,SAAkBT,UACTA,EAAKd,OAASE,2FAlChBf,KAAK+B,mBACHA,YAAc,IAAI/B,KAAK8B,cAAcd,QACrCe,YAAYb,IAAMlB,MAElBA,KAAK+B,kDAIP/B,KAAKgC,iBACHA,UAAY,IAAIhC,KAAK8B,cAAcR,QACnCU,UAAUd,IAAMlB,MAEhBA,KAAKgC,8CAIPhC,KAAKkC,gBACHA,SAAWtC,EAAS6B,EAAUzB,KAAMc,IAEpCd,KAAKkC,gDAIPlC,KAAKiC,mBACHA,YAAcrC,EAAS6B,EAAUzB,KAAMe,IAEvCf,KAAKiC,kBAtChB,sCFhCO,SAA8BI,EAAMC,YAAAA,IAAAA,EAAqB,SAACC,EAAYC,UAAUA,QAC/EC,EAAQJ,EAAKK,OAAO,SAACD,EAAOD,UAChCC,EAAMD,GAAS,CACbjC,IAAK,kBACIP,KAAKU,GAAuBV,KAAMwC,IAE3CG,YAAY,GAEPF,GACN,IAEHA,EAAM/B,GAAyB,CAC7BE,MAAO0B,EACPK,YAAY,EACZC,UAAU,OAGNC,EAAQxD,aAGLyD,EAAiBC,eAAAA,IAAAA,EAAK,QACvB/C,gBAAgB8C,SACd,IAAIE,MAAM,wDAGA,mBAAPD,SACJrC,GAAyBqC,UARlCzD,OAAO2D,iBAAiBJ,EAAOJ,GAY/BK,EAAgBI,UAAYL,EACrBC"}