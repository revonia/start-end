{"version":3,"file":"start-end.js","sources":["../src/utils.js","../src/token-collection.js","../src/part.js","../src/comma-dsl.js"],"sourcesContent":["\r\nexport const createEmptyObject = Object.create.bind(null, null)\r\nexport const freeze = Object.freeze\r\nexport const isArray = Array.isArray\r\n\r\nexport function def (o, p, attributesOrFn) {\r\n  if (isFunction(attributesOrFn)) {\r\n    attributesOrFn = {\r\n      get: attributesOrFn\r\n    }\r\n  }\r\n  return Object.defineProperty(o, p, attributesOrFn)\r\n}\r\n\r\nexport function isFunction (o) {\r\n  return typeof o === 'function'\r\n}\r\n\r\nexport function bindArgs (fn, ...args) {\r\n  return fn.bind(null, ...args)\r\n}\r\n\r\nfunction uniqueObjectToString () {\r\n  return 'UniqueObject(' + this._desc + ')'\r\n}\r\n\r\nexport function createUniqueObject (desc) {\r\n  let obj = createEmptyObject()\r\n  obj._desc = desc\r\n  return freeze(def(obj, 'toString', uniqueObjectToString))\r\n}\r\n","import { createEmptyObject } from './utils'\r\n\r\nconst fetchTokenPlaceholder = '_fetchToken$$'\r\n\r\n/**\r\n * create a token collection\r\n * @example\r\n * const Collection = makeTokenCollection(['div', 'span'])\r\n * const tokens = new Collection()\r\n * tokens.div === 'div'\r\n *\r\n * @param {string[]} tags\r\n * @param {function} fetchTokenCallback\r\n * @returns mixed\r\n */\r\nexport function makeTokenCollection (tags, fetchTokenCallback = (collection, token) => token) {\r\n  const props = tags.reduce((props, token) => {\r\n    props[token] = {\r\n      get: function () {\r\n        return this[fetchTokenPlaceholder](this, token)\r\n      },\r\n      enumerable: true\r\n    }\r\n    return props\r\n  }, {})\r\n\r\n  props[fetchTokenPlaceholder] = {\r\n    value: fetchTokenCallback,\r\n    enumerable: false,\r\n    writable: true\r\n  }\r\n\r\n  const proto = createEmptyObject()\r\n  Object.defineProperties(proto, props)\r\n\r\n  function TokenCollection (cb = null) {\r\n    if (!(this instanceof TokenCollection)) {\r\n      throw new Error('Shouldn\\'t call TokenCollection constructor directly.')\r\n    }\r\n\r\n    if (typeof cb === 'function') {\r\n      this[fetchTokenPlaceholder] = cb\r\n    }\r\n  }\r\n\r\n  TokenCollection.prototype = proto\r\n  return TokenCollection\r\n}\r\n","export default class Part {\r\n  constructor (value = null, type = null) {\r\n    this.value = value\r\n    this.type = type\r\n  }\r\n}\r\n","import Part from './part'\r\nimport { bindArgs, isFunction, createUniqueObject } from './utils'\r\n\r\nconst propTypePart = createUniqueObject('prop')\r\nconst textTypePart = createUniqueObject('text')\r\n\r\nfunction pushStartTag ({ dsl }, tag) {\r\n  if (!dsl.startTagStack) {\r\n    dsl.startTagStack = []\r\n  }\r\n  /* hook */\r\n  if (isFunction(dsl['beforePushStartTag'])) {\r\n    const newTag = dsl.beforePushStartTag(dsl, tag)\r\n    tag = newTag || tag\r\n  }\r\n\r\n  dsl.startTagStack.push(tag)\r\n  return bindArgs(pushEndTag, { dsl }, tag)\r\n}\r\n\r\nfunction pushEndTag ({ dsl }, tag) {\r\n  if (!dsl.endTagStack) {\r\n    dsl.endTagStack = []\r\n  }\r\n  /* hook */\r\n  if (isFunction(dsl['beforePushEndTag'])) {\r\n    const newTag = dsl.beforePushEndTag(dsl, tag)\r\n    tag = newTag || tag\r\n  }\r\n\r\n  dsl.endTagStack.push(tag)\r\n  return dsl\r\n}\r\n\r\nfunction pushPart (dsl, type, data) {\r\n  let part\r\n  /* hook */\r\n  if (isFunction(dsl['beforePushPart'])) {\r\n    part = dsl.beforePushPart(dsl, type, data)\r\n  }\r\n  if (!part) {\r\n    part = new Part(data, type)\r\n  }\r\n  dsl.startTagStack.push(part)\r\n  return dsl\r\n}\r\n\r\nexport class CommaDsl {\r\n  constructor (TagCollection) {\r\n    this.startTagStack = []\r\n    this.endTagStack = []\r\n    this.TagCollection = TagCollection\r\n    this.startTokens = null\r\n    this.endTokens = null\r\n    this.textPart = null\r\n    this.propPart = null\r\n  }\r\n\r\n  get o () {\r\n    if (!this.startTokens) {\r\n      this.startTokens = new this.TagCollection(pushStartTag)\r\n      this.startTokens.dsl = this\r\n    }\r\n    return this.startTokens\r\n  }\r\n\r\n  get x () {\r\n    if (!this.endTokens) {\r\n      this.endTokens = new this.TagCollection(pushEndTag)\r\n      this.endTokens.dsl = this\r\n    }\r\n    return this.endTokens\r\n  }\r\n\r\n  get prop () {\r\n    if (!this.propPart) {\r\n      this.propPart = bindArgs(pushPart, this, propTypePart)\r\n    }\r\n    return this.propPart\r\n  }\r\n\r\n  get text () {\r\n    if (!this.textPart) {\r\n      this.textPart = bindArgs(pushPart, this, textTypePart)\r\n    }\r\n    return this.textPart\r\n  }\r\n\r\n  static isProp (part) {\r\n    return part.type === propTypePart\r\n  }\r\n\r\n  static isText (part) {\r\n    return part.type === textTypePart\r\n  }\r\n}\r\n"],"names":["createEmptyObject","Object","create","bind","freeze","def","o","p","attributesOrFn","isFunction","get","defineProperty","bindArgs","fn","args","uniqueObjectToString","_desc","createUniqueObject","desc","obj","fetchTokenPlaceholder","makeTokenCollection","tags","fetchTokenCallback","collection","token","props","reduce","enumerable","value","writable","proto","defineProperties","TokenCollection","cb","Error","prototype","Part","type","propTypePart","textTypePart","pushStartTag","tag","dsl","startTagStack","newTag","beforePushStartTag","push","pushEndTag","endTagStack","beforePushEndTag","pushPart","data","part","beforePushPart","CommaDsl","TagCollection","startTokens","endTokens","textPart","propPart","isProp","isText"],"mappings":"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"}